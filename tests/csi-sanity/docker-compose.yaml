version: '3'
services:
  plugin:
    build: .
    command: wekafsplugin -nodeid 1 -alsologtostderr -v 9 --endpoint=unix://tmp/weka-csi-test/csi.sock --debugpath=/tmp/weka-csi-test/filesystems
    volumes:
      - test-volume:/tmp/weka-csi-test
    cap_add:
      - SYS_ADMIN
  sanity:
    build: .
    command: csi-sanity --csi.endpoint /tmp/weka-csi-test/csi.sock -csi.mountdir=/tmp/weka-csi-test/sanity-workspace/ -ginkgo.failFast -csi.testvolumeparameters /test/wekafs-vol.yaml  -ginkgo.trace -ginkgo.v
    volumes:
      - test-volume:/tmp/weka-csi-test
volumes:
  test-volume: